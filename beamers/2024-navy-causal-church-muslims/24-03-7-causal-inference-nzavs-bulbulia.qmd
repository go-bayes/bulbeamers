---
title: Causal Inference in Three-Wave Panel Designs
subtitle: with illustrations from the New Zealand Attitudes and Values Study 
author: Joseph A. Bulbulia
institute: Joseph.Bulbulia@vuw.ac.nz (Victoria University)
fontfamily: libertinus
bibliography: /Users/joseph/GIT/templates/bib/references.bib
format: 
  beamer: 
    navigation: horizontal
    aspectratio: 169
    theme: CambridgeUS
    colortheme: orchid
    incremental: false  
    header-includes:
      - \input{/Users/joseph/GIT/latex/latex-for-quarto.tex}
execute:
  echo: false
  warning: false
  error: false
---

```{r}
#| label: load-libraries
#| echo: false
#| include: false
#| eval: true

#tinytex::tlmgr_update()
# for latex graphs
# for making graphs
library("tinytex")
library("extrafont")
library("ggplot2")
library("patchwork")
library("here")
loadfonts(device = "all")
#aspectratio: 169

```


##  The Fundamental Problem of Causal Inference: We Require a Counterfactual Contrast

$$Y_{\text{you}}(1) - Y_{\text{you}}(0)$$  


## But Individuals Experience Only **One** Exposure



$$
Y_i|A_i = 1 \implies Y_i(0)|A_i = 1~ \text{is counterfactual}
$$


## Average Treatment Effect in Randomised Controlled Experiments Work From Assumptions

$$
\text{Average Treatment Effect} = \left[ \begin{aligned}
&\left( \underbrace{\mathbb{E}[Y(1)|A = 1]}_{\text{observed}} + \textcolor{red}{\underbrace{\mathbb{E}[Y(1)|A = 0]}_{\text{unobserved}}} \right) \\
&- \left( \underbrace{\mathbb{E}[Y(0)|A = 0]}_{\text{observed}} + \textcolor{red}{\underbrace{\mathbb{E}[Y(0)|A = 1]}_{\text{unobserved}}} \right)
\end{aligned} \right]
$$

# The Three Fundemental Assumptions of Causal Inference

### Causal Consistency

$$
Y_i^{observed}|A_i = 
\begin{cases} 
Y_i(a^*) & \text{if } A_i = a^* \\
Y_i(a) & \text{if } A_i = a
\end{cases}
$$



### Conditional Exchangeabilty 

$$
Y(a) \coprod A | L \quad \text{or equivalently} \quad A \coprod Y(a) | L
$$

### Positivity 

$$
0 < Pr(A = a | L = l) < 1
$$


## The Common Worry: Confounding by Common Cause

$$\commoncauseA$$

## However, There Are Other Worries: Reverse Causation



$$\ytoa$$



## Another Worry is Mediator Bias


$$\mediatorA$$

## Another Worry is Collider Bias


$$\colliderALONG$$



## Another Worry: Collider Bias Proxy


$$\descendantBBLONG$$

## Post Exposure Collider Bias

$$\mediatorcollider$$


## Another Worry: Unmeasured Common Cause


$$\downstream$$





## Reverse Causation Solution: Longitudional Hygiene


:::: {.columns}

::: {.column width="50%"}
$$\ytoa$$
:::

::: {.column width="50%"}
$$\aandysolution$$
:::

::::

## Mediator Bias Solution: Longitudional Hygiene


:::: {.columns}

::: {.column width="50%"}
$$
\mediatorA
$$
:::

::: {.column width="50%"}
$$
\commoncausesolvedA
$$
:::

::::



## Collider Bias Solution: Longitudional Hygiene


:::: {.columns}

::: {.column width="50%"}
$$\colliderALONG$$
:::

::: {.column width="50%"}
$$\commoncausesolvedA$$
:::

::::


## Collider Bias Proxy **Solution**: Longitudional Hygiene


:::: {.columns}

::: {.column width="50%"}
$$\descendantBBLONG$$
:::

::: {.column width="50%"}
$$\commoncausesolvedchild$$
:::

::::




## Post Exposure Collider Bias Solution: Longitudional Hygiene


:::: {.columns}

::: {.column width="50%"}
$$\mediatorcollider$$
:::

::: {.column width="50%"}
$$\commoncausesolvedA$$
:::

::::






## Unmeasured Common Cause Solution: Longitudional Hygiene


:::: {.columns}

::: {.column width="50%"}
$$\downstream$$
:::

::: {.column width="50%"}
$$\commoncausesolvedA$$
:::

::::

# New Zealand Attitudes and Values Study

## The New Zealand Attitudes and Values Study

  - Planned 20-year longitudinal study, currently in its 14$^{th}$ year.
  
  - Sample frame is drawn randomly from NZ Electoral Roll.

  - Postal questionnaire (coverage; retention ~ 80%)
    
  - Large multidisciplinary research team (40 +)
    
  - Focus on personality, social attitudes, values, religion, employment, prejudice $\dots$
    
  - Current sample contains > 72,290,000 unique people, and ~ 38,000 in the longitudinal study
  
___

![NZAVS Daily Responses](timeline_histgram_2009_2024.png)


___

\LARGE \centering BIG EVENTS

___

![Mosque Attacks: Full Sample](muslim_attack_discontinuity_2012_2022_include_opt_in.png)



## Institutional Trust

**COVID-19 Government response**
-   "I trust the Government to make sensible decisions about how to best manage COVID-19 in New Zealand."
-   "The New Zealand government response to COVID-19."

**Trust in politicians**
-   "Politicians in New Zealand can generally be trusted."

**Institutional trust in police**
-   "People's basic rights are well protected by the New Zealand Police."
-   "There are many things about the New Zealand Police and its policies that need to be changed."
-   "The New Zealand Police care about the well-being of everyone they deal with."  

**General tendency to believe in conspiracies**
-   "I think that the official version of major world events given by authorities often hides the truth."


___

![plot_rdd_covid_trust_politicians](plot_rdd_covid_trust_politicians.png)

___

![plot_rdd_covid_trust_police](plot_rdd_covid_trust_police.png)

___


![plot_rdd_covid_trust_science](plot_rdd_covid_trust_science.png)

___

![plot_rdd_covid_trust_conspiracy](plot_rdd_covid_trust_conspiracy.png)

## Regulate Artificial Intelligence?

___

![better_combo_graph_govt_surveillance_ai](better_combo_graph_govt_surveillance_ai.png)

___

![plot_compare_monthly_weighted_means_govt_surveillance_ai](plot_compare_monthly_weighted_means_govt_surveillance_ai.png)


## Consider Gradual Events 

___

![plot_prob_church_attendance_nz_2009to2024](plot_prob_church_attendance_nz_2009to2024.png)

## Shift Intervention: Religious Service:

### Intervention
$$f(A = a*) = \begin{cases} 4 & \text{if } A < 4  \text{ monthly religious service attendance} \\ \tilde{A} & \text{if } A \geq 4  \text{ monthly religious service attendance} \end{cases} $$

### Contrast
$$f(A) = 0 $$


## Shift Intervention: Socialising

### Intervention
$$f(A) = \begin{cases} 1.4 & \text{if } A \leq 1.4 \text{ hours socialising with community} \\ \tilde{A} & \text{if } A >  1.4  \text{ hours socialising with community}  \end{cases} $$

### Contrast:

$$f(A) = 0 $$



## Key Graph


$$
\threeLONG
$$

## Religious Service Outcomes

___

![plot_gain_church_prosocial_z.png](plot_gain_church_prosocial_z.png)
___

![plot_church_prejudice](plot_church_prejudice.png)

___

![plot_church_help_received](plot_church_help_received.png)

___

![plot_socializing_prosocial](plot_socializing_prosocial.png)
___

![plot_warm_socialising](plot_warm_socialising.png)
___

![plot_socialising_gain_help_received](plot_socialising_gain_help_received.png)

## Results

- The causal effects of religious service attendance on the economy are invisible, but likely considerable, representing in expectation ~ **0.048%** of New Zealand's 2021 annual government budget.
- This result underscores the importance of investigating the consequences of gradual declines in cultural engagement and perhaps other domains of society.
- What do you think we should be focussing on? 

```{r}
# #| label: calculation
# 
# 
# # model estimates for charity under each intervention
# counterfactual_charity_donate <-  1822.649
# estimate_charity_donate <- 1118.993
# # NZ > 18 year olds in 2022
# nz_adult_population <- 3989000
# 
# # annual factual and counterfactual estimates
# factual_charity_estimate <- nz_adult_population * estimate_charity_donate
# counterfactual_factual_charity_estimate = nz_adult_population * counterfactual_charity_donate
# 
# # difference
# counterfactual_difference_charity_donate = counterfactual_factual_charity_estimate - factual_charity_estimate
# # percentage change
# print(counterfactual_difference_charity_donate)
# 
# # ~ 3 billion NZD 
# # 2,806,882,916
# 
# nz annual budget in 2021
# nz_annual_budget = 14494000000 * 4 # treasury (https://www.treasury.govt.nz/publications/budgets/budget-2021)
# 
# # intervention as percentage of gov't annual budget 
# counterfactual_difference_charity_donate/ nz_annual_budget
```

## Summary

::: {.incremental}
  1. To move beyond association to causality requires time, literally. 
  2. Big events $\neq$ big effect sizes.
  3. Long-term effects unclear.
  4. Short-term change is perhaps more important for planning.
:::


## Thanks {.nonincremental}

:::{.nonincremental}
- Chris G. Sibley (NZAVS lead Investigator)
- TRT Grant 0418
- Max Planck Institute for Evolutionary Anthropology
- Victoria University
- University of Canterbury
- 72,290 NZAVS participants
:::

___

![NZAVS](NZAVS-QR.png)

## Extra Slides

## Longitudinal Data Bring Their Own Problems 


## Timing of Confounder

$$ 
\threeBshortTHREEWAVE 
$$

## Timing of Mediator 

$$
\threeCshortTHREEWAVE
$$

## Treatment Confounder Bias

$$\feedback$$

## Treatment Confounder Feedback

$$\feedbackA$$

## Treatment Confounder Feedback Variation


$$\feedbackBshort$$

## Mediation


$$
\tiny \mediationfull
$$

## Mediation 

## Total Effect 

:::: {.columns}

::: {.column width="50%"}
$$
TE = \mathbb{E}[Y(1)] - \mathbb{E}[Y(0)]
$$
:::

::: {.column width="60%"}
$$~~$$
:::

::::



## Total Effect Considering Mediator

:::: {.columns}

::: {.column width="50%"}
$$
TE = \mathbb{E}[Y(1)] - \mathbb{E}[Y(0)]
$$
:::

::: {.column width="50%"}
$$ 
\mathbb{E}[Y(1)] = \mathbb{E}[Y(1, M(1))]
$$
:::

::::


## Natural Direct Effect

**Natural Direct Effect (NDE)** is the effect of the treatment on the
outcome while maintaining the mediator at the level it would have been
if the treatment had *not* been applied:

$$
 NDE = \textcolor{blue}{\mathbb{E}[Y(1, M(0))]} - \mathbb{E}[Y(0, M(0))]
$$




## Natural Indirect Effect

**Natural Indirect Effect (NIE):** is the effect of the exposure on the
outcome that is mediated. To obtain these quantities we must compare the
potential outcome $Y$ under treatment, where the mediator assumes its
natural level under treatment with the potential outcome when the
mediator assumes its natural value under no treatment is given:

$$
 NIE = \mathbb{E}[Y(1, M(1))] - \textcolor{blue}{\mathbb{E}[Y(1, M(0))]}
$$

## Decomposition

$$
\scriptsize{ \text{Total Effect (TE)} = \underbrace{\bigg\{\mathbb{E}[Y(1, M(1))] - \textcolor{blue}{\mathbb{E}[Y(1, M(0))]}\bigg\}}_{\text{Natural Indirect Effect (NIE)}} + \underbrace{\bigg\{\textcolor{blue}{\mathbb{E}[Y(1, M(0))]} - \mathbb{E}[Y(0, M(0))]\bigg\}}_{\text{Natural Direct Effect (NDE)}}}
$$


## Why Mediation is Difficult


$$
\mediationfull
$$


## Interaction


<!-- ## Interaction: potential outcomes -->

<!-- $$\tiny {\bigg(\underbrace{\mathbb{E}[Y(1,1)]}_{\text{joint exposure}} - \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}}\bigg) - \bigg[ \bigg(\underbrace{\mathbb{E}[Y(1,0)]}_{\text{only A exposed}} - \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}}\bigg) + \bigg(\underbrace{\mathbb{E}[Y(0,1)]}_{\text{only B exposed}} - \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}} \bigg)\bigg] \neq 0} $$ -->



## Interaction: simplifies to 

$$\scriptsize{\underbrace{\mathbb{E}[Y(1,1)]}_{\text{joint exposure}} - \underbrace{\mathbb{E}[Y(1,0)]}_{\text{only A exposed}} - \underbrace{\mathbb{E}[Y(0,1)]}_{\text{only B exposed}} + \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}} \neq 0} $$


<!-- A positive value would indicate evidence for additive interaction. A -->
<!-- negative value would indicate evidence for sub-additive interaction. A -->
<!-- value near zero would imply no reliable evidence for interaction. -->


## Key

$$\terminologylocalconventions$$

___

\begin{adjustbox}{height=0.5\textheight, keepaspectratio}
$$
\footnotesize \terminologydirectedgraph
$$
\end{adjustbox}





